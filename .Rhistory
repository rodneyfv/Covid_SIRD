# tem IDH maior que a mediana e 0 caso contrário
tmp <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::summarize(med = median(IDHM_Renda)) %>%
dplyr::summarize(median(med))
mun_df_grupo <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::mutate(idh_grupo = ifelse(median(IDHM_Renda)>tmp,1,0))
View(mun_df_grupo)
# criando uma matriz para ser usada na função fanova.tests, tendo as
# curvas observadas nas colunas e pontos de discretização nas linhas
tmp <- mun_df_grupo %>% select(Município,Data,R_e) %>%
tidyr::spread(key = Município, value = R_e)
dados_fanova <- tmp %>% select(-Data) %>% as.matrix
rownames(dados_fanova) <- tmp$Data %>% as.character
# vetor com os grupos referente a cada curva observada
grupos_fanova <- mun_df_grupo %>% select(Município,idh_grupo) %>%
dplyr::group_by(Município) %>% unique %>% as.matrix
# checando se todos os grupos tem mais de duas observações (condição
# necessária para usar o pacote fdanova)
prod(table(grupos_fanova[,2])>1)
# Avaliando o efeito de IHHM_Renda
library("fdANOVA")
plotFANOVA(x = dados_fanova, group.label = grupos_fanova[,2],
means = TRUE)
fanova <- fanova.tests(x = dados_fanova,
group.label = grupos_fanova[,2], test = "FP",
parallel = TRUE, nslaves = 2)
summary(fanova)
fanova <- fanova.tests(x = dados_fanova,
group.label = grupos_fanova[,2],
parallel = TRUE, nslaves = 2)
summary(fanova)
tmp <- rnorm(1000)
quantile(tmp,.5)
median(tmp)
tmp2 <- quantile(tmp,.5)
tmp2[[1]]
tmp2[1]
tmp <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município)
View(tmp)
tmp <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::summarize(med = unique(IDHM_Renda))
# criando uma variável dummy nos dados que assume 1 se o município
# tem IDH maior que a mediana e 0 caso contrário
tmp <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::summarize(med = unique(IDHM_Renda)) %>%
dplyr::summarize(Q1 = quantile(med,.25)[[1]],
Q2 = quantile(med,.5)[[1]],
Q3 = quantile(med,.75)[[1]])
tmp
# criando uma variável dummy nos dados que assume 1 se o município
# tem IDH maior que a mediana e 0 caso contrário
tmp <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::summarize(med = median(IDHM_Renda)) %>%
dplyr::summarize(median(med))
tmp
mun_df_grupo <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::mutate(idh_grupo = ifelse(unique(IDHM_Renda)<Q1,1,
ifelse(unique(IDHM_Renda)<Q2,2,
ifelse(unique(IDHM_Renda)<Q3,3,4))))
# criando uma variável dummy nos dados que assume 1 se o município
# tem IDH maior que a mediana e 0 caso contrário
tmp <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::summarize(med = unique(IDHM_Renda)) %>%
dplyr::summarize(Q1 = quantile(med,.25)[[1]],
Q2 = quantile(med,.5)[[1]],
Q3 = quantile(med,.75)[[1]])
mun_df_grupo <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::mutate(idh_grupo = ifelse(unique(IDHM_Renda)<tmp$Q1,1,
ifelse(unique(IDHM_Renda)<tmp$Q2,2,
ifelse(unique(IDHM_Renda)<tmp$Q3,3,4))))
View(mun_df_grupo)
# criando uma variável dummy nos dados que assume 1 se o município
# tem IDH maior que a mediana e 0 caso contrário
grup_quartis <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::summarize(med = unique(IDHM_Renda)) %>%
dplyr::summarize(Q1 = quantile(med,.25)[[1]],
Q2 = quantile(med,.5)[[1]],
Q3 = quantile(med,.75)[[1]])
mun_df_grupo <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::mutate(idh_grupo = ifelse(unique(IDHM_Renda)<grup_quartis$Q1,1,
ifelse(unique(IDHM_Renda)<grup_quartis$Q2,2,
ifelse(unique(IDHM_Renda)<grup_quartis$Q3,3,4))))
View(mun_df_grupo)
# vetor com os grupos referente a cada curva observada
grupos_fanova <- mun_df_grupo %>% select(Município,idh_grupo) %>%
dplyr::group_by(Município) %>% unique %>% as.matrix
grupos_fanova[,2]
table(grupos_fanova[,2])
# checando se todos os grupos tem mais de duas observações (condição
# necessária para usar o pacote fdanova)
prod(table(grupos_fanova[,2])>1)
View(mun_df_grupo)
tmp <- mun_df_grupo %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .4) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo))
ggplotly(p)
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=Estado)) +
geom_line(aes(group=Município), alpha = .4) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
# curva dos municípios do estado usado no filtro e a respectiva
# curva média, usando a função ggploty
tmp <- estim_mun_df %>% dplyr::filter(Estado=='SAO PAULO') %>%
group_by(Estado,Data) %>%
dplyr::summarize(R_e = mean(R_e))
p <- estim_mun_df %>% dplyr::filter(Estado=='SAO PAULO') %>%
ggplot( aes(x=Data, y=R_e,color=Estado)) +
geom_line(aes(group=Município), alpha = .4) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
#  coord_cartesian( ylim = c(0, 20))
ggplotly(p)
tmp <- mun_df_grupo %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
tmp <- mun_df_grupo %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=Estado)) +
geom_line(aes(group=Município), alpha = .4) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=Estado)) +
geom_line(aes(Município), alpha = .4) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=Estado)) +
geom_line(aes(group=Município), alpha = .4) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=Estado)) +
geom_line(aes(group=Município), alpha = .4)
mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .4)
mun_df_grupo <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::mutate(idh_grupo = ifelse(unique(IDHM_Renda)<grup_quartis$Q1,"1",
ifelse(unique(IDHM_Renda)<grup_quartis$Q2,"2",
ifelse(unique(IDHM_Renda)<grup_quartis$Q3,"3","4"))))
# vetor com os grupos referente a cada curva observada
grupos_fanova <- mun_df_grupo %>% select(Município,idh_grupo) %>%
dplyr::group_by(Município) %>% unique %>% as.matrix
table(grupos_fanova[,2])
tmp <- mun_df_grupo %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .4)
mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .4) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .6) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .6) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
p <- mun_df_grupo %>%
ggplot( aes(x=Data, y=R_e)) +
geom_line(aes(group=Município), alpha = .6) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
tmp <- mun_df_grupo %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
p <- mun_df_grupo %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .6) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
?left_join
tmp <- mun_df_grupo %>% left_join(estim_mun_df)
tmp <- mun_df_grupo %>% left_join(estim_mun_df) %>%
dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
p <- mun_df_grupo %>% left_join(estim_mun_df) %>%
dplyr::filter(Estado=='RIO DE JANEIRO') %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .6) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
tmp <- estim_mun_df %>% left_join(mun_df_grupo) %>%
dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
p <- estim_mun_df %>% left_join(mun_df_grupo) %>%
dplyr::filter(Estado=='RIO DE JANEIRO') %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .6) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
mun_df_grupo <- estim_mun_df %>% dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Município) %>% dplyr::mutate(idh_grupo = ifelse(unique(IDHM_Renda)<grup_quartis$Q1,"ind<Q1",
ifelse(unique(IDHM_Renda)<grup_quartis$Q2,"Q1<ind<Q2",
ifelse(unique(IDHM_Renda)<grup_quartis$Q3,"Q2<ind<Q3","ind>Q3"))))
# vetor com os grupos referente a cada curva observada
grupos_fanova <- mun_df_grupo %>% select(Município,idh_grupo) %>%
dplyr::group_by(Município) %>% unique %>% as.matrix
# checando se todos os grupos tem mais de duas observações (condição
# necessária para usar o pacote fdanova)
prod(table(grupos_fanova[,2])>1)
table(grupos_fanova[,2])
tmp <- estim_mun_df %>% left_join(mun_df_grupo) %>%
dplyr::filter(Estado=='RIO DE JANEIRO') %>%
group_by(Data) %>%
dplyr::summarize(R_e = mean(R_e))
p <- estim_mun_df %>% left_join(mun_df_grupo) %>%
dplyr::filter(Estado=='RIO DE JANEIRO') %>%
ggplot( aes(x=Data, y=R_e,color=idh_grupo)) +
geom_line(aes(group=Município), alpha = .6) +
geom_line(data=tmp, alpha = .8, size = 1.5,color="black")
ggplotly(p)
fanova <- fanova.tests(x = dados_fanova,
group.label = grupos_fanova[,2], test = "FP",
parallel = TRUE, nslaves = 2)
summary(fanova)
require(shiny)
runApp('./shiny_mun_curvas/')
head(mun)
colnames(mun)
# Lendo os dados dos municípios
mun <- readRDS("./dados_por_municipio.rds")
colnames(mun)
runApp('./shiny_mun_curvas/')
runApp('./shiny_mun_curvas/')
# Nome do arquivo do min. saude
arquivo_min_saude <- "HIST_PAINEL_COVIDBR_31mai2020.xlsx"
# Nome do arquivo a ser usado como historico
arquivo_historico <- "Dados_Municipais_wide.csv"
pacote <- function(p){
if (!is.element(p, installed.packages()[,1])){
message('Pacote ',p,' nao encontrado. Instalando..')
install.packages(p, dep = TRUE)
}
message('Carregando pacote ',p)
require_worked <- try(require(p, character.only = TRUE))
if(!require_worked) {
install.packages(p, dep = TRUE)
}
}
pacote("tidyverse")
pacote("lubridate")
pacote("writexl")
pacote("httr")
pacote("readr")
pacote("readxl")
# Atualizando tidyr se necessario
if(installed.packages() %>% as.data.frame %>% dplyr::filter(Package == "tidyr") %>% pull(Version) %>% as.character < "1.0") {
install.packages("tidyr")
pacote("tidyr")
}
municipais_wide <- read_csv(arquivo_historico) %>% # Dados enviados por Henrique e Iuri
dplyr::mutate(Codigo = as.character(Codigo))
View(municipais_wide)
# Lendo os dados dos municípios
mun <- readRDS("../dados_por_municipio.rds")
# Lendo os dados dos municípios
mun <- readRDS("./dados_por_municipio.rds")
colnames(mun)
rm(mun)
municipais_wide <- read_csv(arquivo_historico) %>% # Dados enviados por Henrique e Iuri
dplyr::mutate(Codigo = as.character(Codigo))
df_caracteristicas_fixas <- municipais_wide %>% dplyr::select(- starts_with("casos"), - starts_with("mortes"))
municipais_wide_casos <- municipais_wide %>% dplyr::select(Codigo, starts_with("casos."))
municipais_wide_mortes <- municipais_wide %>% dplyr::select(Codigo, starts_with("mortes."))
View(municipais_wide_casos)
View(municipais_wide_casos)
mun_casos <- municipais_wide_casos %>% pivot_longer(- c(Codigo), names_to = "Data", values_to = "confirmed")
View(mun_casos)
mun_casos <- municipais_wide_casos %>% pivot_longer(- c(Codigo), names_to = "Data", values_to = "confirmed") %>%
dplyr::mutate(Data = Data %>% str_replace_all("casos.", "") %>% ymd)
?full_join
mun <- municipais_wide_mortes %>% pivot_longer(- c(Codigo), names_to = "Data", values_to = "deaths") %>%
dplyr::mutate(Data = Data %>% str_replace_all("mortes.", "") %>% ymd) %>% full_join(mun_casos)
View(mun)
mun_casos <- municipais_wide_casos %>%
pivot_longer(- c(Codigo), names_to = "Data", values_to = "confirmed") %>%
dplyr::mutate(Data = Data %>% str_replace_all("casos.", "") %>% ymd)
mun <- municipais_wide_mortes %>%
pivot_longer(- c(Codigo), names_to = "Data", values_to = "deaths") %>%
dplyr::mutate(Data = Data %>% str_replace_all("mortes.", "") %>% ymd) %>%
full_join(mun_casos)
df_msaude <- read_excel(paste0(arquivo_min_saude), guess_max = 100000) %>%
dplyr::select(Data = data, Codigo = codmun, deaths = obitosAcumulado,
Municipio = municipio, codDRS = codRegiaoSaude,
nomDRS = nomeRegiaoSaude, confirmed = casosAcumulado) %>%
dplyr::mutate(Data = ymd(Data),
confirmed = as.numeric(confirmed),
deaths = as.numeric(deaths)) %>%
dplyr::filter(!is.na(Municipio)) %>% dplyr::select(-Municipio)
# Existem municípios com linhas duplicadas para uma mesma data de 30/05.
# Vamos remover agora pra seguir com a análise
tmp <- sort(unique(df_msaude$Data),decreasing = TRUE)[c(1:2)]
df_msaude <- df_msaude %>% filter(!(Data %in% tmp))
ultima_data_disponivel <- df_msaude$Data %>% max
# Vendo quais municipios nao estao indo ate a ultima data da base (possiveis erros)
codigos_com_erro <- df_msaude %>% dplyr::group_by(Codigo) %>%
dplyr::summarise(menor_data = min(Data), maior_data = max(Data)) %>%
dplyr::arrange(maior_data) %>% dplyr::filter(maior_data != max(maior_data)) %>%
dplyr::pull(Codigo)
message("Numero de municipios que nao vao ate o final: ", length(codigos_com_erro))
message("Valores de casos acumulados para os municipios com esse erro: ",
df_msaude %>% dplyr::filter(Codigo %in% codigos_com_erro) %>%
dplyr::pull(confirmed) %>% unique %>% sort %>% paste(collapse = ", "))
message("Vou completar esses municipios repetindo o ultimo valor de casos e
obitos ate a ultima data")
for(cod_ in codigos_com_erro) {
tbl_temp <- df_msaude %>% dplyr::filter(Codigo == cod_) %>%
dplyr::filter(Data == max(Data)) %>% unique()
ultima_data <- tbl_temp$Data
datas_faltantes <- seq.Date(from = ultima_data + 1, to = ultima_data_disponivel, by = 1)
tbl_completando <- tibble(Data = datas_faltantes, Codigo = cod_) %>%
left_join(tbl_temp %>% dplyr::select(-Data), by = "Codigo") %>%
dplyr::select(colnames(tbl_temp))
df_msaude <- rbind(df_msaude, tbl_completando)
}
# Essa base ja esta com todos os municipios indo ate a ultima data
df_msaude <- df_msaude %>% dplyr::arrange(Codigo, Data)
View(df_msaude)
comparacao_primeiro_dia <- df_msaude %>% dplyr::group_by(Codigo) %>%
dplyr::filter(Data == min(Data)) %>%
dplyr::select(everything(), deaths_MS = deaths,
confirmed_MS = confirmed) %>% left_join(mun)
comparacao_primeiro_dia <- comparacao_primeiro_dia %>% dplyr::mutate(
check_confirmed = confirmed_MS - confirmed,
check_deaths = deaths_MS - deaths
)
# Verificano se os municipios que nem entraram, ate hoje, no do MSaude
# possuem um numero relevante de casos segundo Brasil.IO
mun_apenas_BrasilIO <- mun %>% dplyr::filter(!Codigo %in% unique(df_msaude$Codigo)) %>%
dplyr::group_by(Codigo) %>% dplyr::filter(Data == max(Data))  %>% dplyr::arrange(desc(confirmed))
# Dentre os municipios que estao no MS, pegando as datas anteriores
#  as disponiveis no MS
keys_fora_do_df_msaude <- anti_join(mun %>% dplyr::filter(Codigo %in% unique(df_msaude$Codigo)) %>%
dplyr::select(Codigo, Data), df_msaude %>%
dplyr::select(Codigo, Data)) %>%
left_join(mun)
dados <- rbind(keys_fora_do_df_msaude, df_msaude)
dim(keys_fora_do_df_msaude)
dim(df_msaude)
head(keys_fora_do_df_msaude)
head(df_msaude)
length(unique(df_msaude$Codigo))
length(unique(keys_fora_do_df_msaude$Codigo))
tmp <- left_join(keys_fora_do_df_msaude,df_msaude,by=c(Codigo, Data))
tmp <- left_join(keys_fora_do_df_msaude,df_msaude,by=c("Codigo", "Data"))
dim(tmp)
dim(keys_fora_do_df_msaude)
View(tmp)
tmp <- df_msaude %>% select(Codigo,Data,codDRS,nomDRS) %>%
right_join(keys_fora_do_df_msaude,by=c("Codigo", "Data"))
dim(tmp)
View(tmp)
tmp <- keys_fora_do_df_msaude %>% group_by(Codigo,Data) %>%
right_join(df_msaude,by=c("Codigo", "Data"))
tmp <- keys_fora_do_df_msaude %>% group_by(Codigo,Data) %>%
right_join(df_msaude %>% select(Codigo,Data,codDRS,nomDRS),
by=c("Codigo", "Data"))
tmp <- keys_fora_do_df_msaude %>% group_by(Codigo,Data) %>%
right_join(df_msaude %>% select(Codigo,Data,codDRS,nomDRS),
by=c("Codigo", "Data")) %>% ungroup
tmp <- inner_join(keys_fora_do_df_msaude,df_msaude,by=c("Codigo", "Data"))
tmp <- inner_join(keys_fora_do_df_msaude,
df_msaude %>% select(Codigo,Data,codDRS,nomDRS),
by=c("Codigo", "Data"))
View(tmp)
dim(keys_fora_do_df_msaude)
dim(df_msaude)
View(df_msaude)
View(keys_fora_do_df_msaude)
tmp <- inner_join(keys_fora_do_df_msaude,
df_msaude %>% select(Codigo,codDRS,nomDRS),
by=c("Codigo"))
dim(tmp)
tmp <- keys_fora_do_df_msaude %>% group_by(Codigo) %>%
inner_join(df_msaude %>% group_by(Codigo,codDRS,nomDRS),
by=c("Codigo"))
dim(tmp)
tmp <- df_msaude %>% group_by(Codigo,codDRS,nomDRS)
tmp <- df_msaude %>% select(Codigo,codDRS,nomDRS) %>% group_by(Codigo,codDRS,nomDRS)
tmp <- df_msaude %>% select(Codigo,codDRS,nomDRS) %>%
group_by(Codigo,codDRS,nomDRS) %>% distinct()
tmp <- keys_fora_do_df_msaude %>% group_by(Codigo) %>%
inner_join(df_msaude %>% select(Codigo,codDRS,nomDRS) %>%
group_by(Codigo,codDRS,nomDRS) %>% distinct(),
by=c("Codigo")) %>% ungroup()
dim(tmp)
dim(keys_fora_do_df_msaude)
# adicionando os dados de DRS referentes aos municípios neste dataframe
keys_fora_do_df_msaude <- keys_fora_do_df_msaude %>% group_by(Codigo) %>%
inner_join(df_msaude %>% select(Codigo,codDRS,nomDRS) %>%
group_by(Codigo,codDRS,nomDRS) %>% distinct(),
by=c("Codigo")) %>% ungroup()
dados <- rbind(keys_fora_do_df_msaude, df_msaude)
dados_sem_buracos <- expand.grid(Codigo = unique(dados$Codigo), Data = unique(dados$Data)) %>%
dplyr::mutate(Codigo = as.character(Codigo), Data = ymd(Data))
buracos <- anti_join(dados_sem_buracos, dados %>% dplyr::select(Codigo, Data))
dim(buracos)
head(buracos)
filter(dados,Codigo=="310260")
filter(dados,Codigo=="310260") %>% View
table(buracos$Data)
# Vou substituir os buracos pelo ultimo dado. Sao poucos confirmados e
# obitos nesses casos.
buracos <- buracos %>% dplyr::mutate(confirmed = NA, deaths = NA)
buracos <- anti_join(dados_sem_buracos, dados %>% dplyr::select(Codigo, Data))
# Vou substituir os buracos pelo ultimo dado. Sao poucos confirmados e
# obitos nesses casos.
buracos <- buracos %>% dplyr::mutate(confirmed = NA, deaths = NA)
for(i_b in 1:nrow(buracos)) {
buracos$confirmed[i_b] <- mun %>%
dplyr::filter(Codigo == buracos[i_b,]$Codigo, Data < buracos[i_b,]$Data) %>%
dplyr::pull(confirmed) %>% last %>% as.numeric
buracos$deaths[i_b] <- mun %>%
dplyr::filter(Codigo == buracos[i_b,]$Codigo, Data < buracos[i_b,]$Data) %>%
dplyr::pull(deaths) %>% last %>% as.numeric
}
dados <- rbind(dados, buracos) %>% dplyr::arrange(Codigo, Data)
dim(dados)
dim(buracos)
tmp <- buracos %>% group_by(Codigo) %>%
inner_join(df_msaude %>% select(Codigo,codDRS,nomDRS) %>%
group_by(Codigo,codDRS,nomDRS) %>% distinct(),
by=c("Codigo")) %>% ungroup()
dim(tmp)
# adicionando os dados de DRS referentes aos municípios neste dataframe
buracos <- buracos %>% group_by(Codigo) %>%
inner_join(df_msaude %>% select(Codigo,codDRS,nomDRS) %>%
group_by(Codigo,codDRS,nomDRS) %>% distinct(),
by=c("Codigo")) %>% ungroup()
dados <- rbind(dados, buracos) %>% dplyr::arrange(Codigo, Data)
# Check de que nao tem mais buracos:
nrow(dados) == nrow(dados_sem_buracos)
dados_finais <- dados %>% left_join(df_caracteristicas_fixas)
saveRDS(dados_finais, "dados_por_municipio.rds")
#
dados_finais_agg <- dados_finais %>% dplyr::group_by(Data) %>%
dplyr::summarise(confirmed = sum(confirmed), deaths = sum(deaths))
MS_BR <- read_excel(arquivo_min_saude, guess_max = 1000000) %>% dplyr::filter(regiao == "Brasil")
MS_BR <- MS_BR %>%
dplyr::select(data, casosAcumulado, obitosAcumulado, Recuperadosnovos) %>%
dplyr::mutate(Data = ymd(data), confirmed = as.numeric(casosAcumulado),
deaths = as.numeric(obitosAcumulado), recovered = as.numeric(Recuperadosnovos),
recovered = ifelse(is.na(recovered), 0, recovered)) %>% dplyr::select(Data, confirmed, deaths, recovered)
View
View(dados_finais_agg)
View(MS_BR)
dados <- read.csv("mun_2SemEpd.csv")
dados <- read.csv("mun_2SemEpd.csv")
View(dados)
# Tabelas de contingência: IDHM x 2 Semanas epidem.
tmp <- dados %>% group_by(Estado,Município) %>%
select(grupIDHM,grupSemEpd) %>%
distinct()
library(dplyr)
# Tabelas de contingência: IDHM x 2 Semanas epidem.
tmp <- dados %>% group_by(Estado,Município) %>%
select(grupIDHM,grupSemEpd) %>%
distinct()
table(tmp$grupIDHM,tmp$grupSemEpd)
prop.table(table(tmp$grupIDHM,tmp$grupSemEpd))
# Tabelas de contingência: urbanização x 2 Semanas epidem.
tmp <- dados %>% group_by(Estado,Município) %>%
select(classe_urb,grupSemEpd) %>%
distinct()
table(tmp$classe_urb,tmp$grupSemEpd)
prop.table(table(tmp$classe_urb,tmp$grupSemEpd))
# número de municípios dentro de cada estado que tem ou não 2
# semanas epidemiológicas
dados %>% select(Estado, Município, grupSemEpd) %>%
distinct() %>% group_by(Estado, grupSemEpd) %>%
dplyr::summarise(n = n()) %>% spread(key = grupSemEpd, value = n) %>%
print(n=30)
library(tidyr)
# número de municípios dentro de cada estado que tem ou não 2
# semanas epidemiológicas
dados %>% select(Estado, Município, grupSemEpd) %>%
distinct() %>% group_by(Estado, grupSemEpd) %>%
dplyr::summarise(n = n()) %>% spread(key = grupSemEpd, value = n) %>%
print(n=30)
# número de municípios dentro de cada estado que pertencem a cada
# um dos grupos de IDHM
dados %>% select(Estado, Município, grupIDHM) %>%
distinct() %>% group_by(Estado, grupIDHM) %>%
dplyr::summarise(n = n()) %>% spread(key = grupIDHM, value = n) %>%
print(n=30)
# dentre os municípios que tem 2 semanas epidemiológicas, quantos destes
# dentro de cada estado pertencem a cada um dos grupos de IDHM
dados %>% filter(grupSemEpd==TRUE) %>%
select(Estado, Município, grupIDHM) %>%
distinct() %>% group_by(Estado, grupIDHM) %>%
dplyr::summarise(n = n()) %>% spread(key = grupIDHM, value = n) %>%
print(n=30)
dados <- read.csv("mun_2SemEpd.csv")
